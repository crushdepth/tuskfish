<form class="form-horizontal" action="admin.php" method="post" enctype="multipart/form-data" role="form" accept-charset="UTF-8">
    
    <div class="row">
        
        <!-- ID -->
        <input type="hidden" name="id" value="<?php echo $content->escape('id'); ?>">
        
        <!-- Media file type compatibility alert -->
        <div class="col-12">
          <div class="mb-3 alert alert-danger alert-dismissible fade d-none" role="alert">
            <?php echo '<i class="fas fa-exclamation-triangle"></i> ' . TFISH_MEDIA_NOT_COMPATIBLE; ?>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        </div>
        
        <!-- Type -->
        <div class="col-md-6 col-lg-4 mb-3 text-left" id="typeContainer">
          <label for="type"><strong><?php echo TFISH_TYPE; ?></strong></label>
          <select class="form-control custom-select" name="type" id="type" required>
                <?php
                  foreach ($content_types as $key => $type) {
                      if ($content->type === $key) {
                          echo '<option value="' . $key . '" selected>' . $type . '</option>';
                      } else {
                          echo '<option value="' . $key . '">' . $type . '</option>';
                      }
                  }
                ?>
          </select>
        </div>

        <!-- Date (bootstrap-datepicker) -->
        <div class="col-md-6 col-lg-4 mb-3 text-left" id="dateContainer">
            <label for="date"><strong><?php echo TFISH_DATE; ?></strong></label>
            <input type="text" class="form-control" name="date" id="date" <?php if (isset($content->date)) { echo 'value="' . $content->date . '"'; } ?>>
        </div>
        <script>
        $(document).ready(function() {
          $('#date').datepicker({
              format: 'yyyy-mm-dd',
              todayHighlight: 'true',
              todayBtn: 'linked',
              startView: 'years'
          });
          $('#date').datepicker('setDate', new Date());
          $('#date').datepicker('update');
        });
        </script>

        <!-- Tags -->
        <div class="col-md-6 col-lg-4 mb-3 text-left" id="tagsContainer">
            <label for="tags"><strong><?php echo TFISH_TAGS; ?></strong></label>
            <select multiple class="form-control custom-select" size="5" name="tags[]" id="tags">
                <?php
                    foreach ($tags as $tag_id => $tag_title) {
                        if (isset($content->tags) && in_array($tag_id, $content->tags)) {
                            echo '<option value="' . $tag_id . '" selected>' . $tag_title . '</option>';
                        } else {
                            echo '<option value="' . $tag_id . '">' . $tag_title . '</option>';
                        }
                    }
                ?>
            </select>
        </div>

        <!-- Title -->
        <div class="col-12 mb-3 text-left" id="titleContainer">
            <label for="title"><strong><?php echo TFISH_TITLE; ?></strong></label>
            <input type="text" class="form-control" name="title" id="title" <?php if (isset($content->title)) echo 'value="' . $content->escape('title') . '"'; ?>>
        </div>

        <!-- Teaser -->
        <div class="col-12 mb-3 text-left" id="teaserContainer">
            <label for="teaser"><strong><?php echo TFISH_TEASER; ?></strong></label>
            <textarea id="teaser" name="teaser" class="form-control text-left"><?php if (isset($content->teaser)) { echo $content->escape('teaser', true); } ?></textarea>
        </div>

        <!-- Description -->
        <div class="col-12 mb-3 text-left" id="descriptionContainer">
            <label for="description"><strong><?php echo TFISH_DESCRIPTION; ?></strong></label>
            <textarea id="description" name="description" class="form-control text-left"><?php if (isset($content->description)) { echo $content->escape('description', true); } ?></textarea>
        </div>

        <!-- Creator (author) -->
        <div class="col-md-6 mb-3 text-left" id="creatorContainer">
            <label for="creator"><strong><?php echo TFISH_CREATOR; ?></strong></label>
            <input type="text" class="form-control" name="creator" id="creator" <?php if (isset($content->creator)) echo 'value="' . $content->escape('creator') . '"'; ?>>
        </div>

        <!-- Publisher -->
        <div class="col-md-6 mb-3 text-left" id="publisherContainer">
            <label for="publisher"><strong><?php echo TFISH_PUBLISHER; ?></strong></label>
            <input type="text" class="form-control" name="publisher" id="publisher" <?php if (isset($content->publisher)) echo 'value="' . $content->escape('publisher') . '"'; ?>>
        </div>
        
        <!-- Parent -->
        <div class="col-12 mb-3 text-left" id="parentContainer">
            <label for="publisher"><strong><?php echo TFISH_PARENT; ?></strong></label>
            <select class="form-control custom-select" name="parent" id="parent" required>
            <?php foreach ($parent_select_options as $key => $option): ?>
                <?php if ($key === $content->id): ?>
                    <option value="<?php echo $key; ?>" disabled><?php echo $option; ?></option>
                <?php elseif ($key === $content->parent): ?>
                    <option value="<?php echo $key; ?>" selected><?php echo $option; ?></option>
                <?php else: ?>
                    <option value="<?php echo $key; ?>"><?php echo $option; ?></option>
                <?php endif; ?> 
            <?php endforeach; ?>
            </select>
        </div>

        <!-- Image -->
        <?php if (isset($content->image) && !empty($content->image)): ?>
        <div class="col-md-6 mb-4 text-left" id="imageContainer">
            <label for="image"><strong><?php echo TFISH_IMAGE; ?></strong></label>
            <input id="image" name="image" type="file" data-preview-file-type="image" value="<?php echo $content->escape('image'); ?>">
        </div>
        <?php else: ?>
            <div class="col-md-6 mb-3 text-left" id="imageContainer">
                <label for="image"><strong><?php echo TFISH_IMAGE; ?></strong></label>
                <input id="image" name="image" type="file" data-preview-file-type="image">
            </div>
        <?php endif; ?>
        <script>
        $(document).ready(function() {
            $("#image").fileinput({
            'showUpload': false,
            'allowedFileExtensions': ["gif", "jpg", "png"],
            'previewFileType': ["image"],
            'initialPreview': '<?php if ($content->image) echo TFISH_IMAGE_URL . $content->escape("image"); ?>',
            'initialPreviewAsData': true,
            'initialPreviewShowDelete': false,
            'initialPreviewDownloadUrl': '<?php if ($content->image) echo TFISH_IMAGE_URL . $content->escape("image"); ?>',
            'initialCaption': '<?php if (isset($content->image)) echo $content->escape("image"); ?>',
            'theme': "fa"});

            $('#image').on('fileclear', function(tf_deleteImage) {
                document.getElementById("deleteImage").value = "1";
            });
        });
        </script>
        
        <!-- Delete image -->
        <input type="hidden" name="deleteImage" id="deleteImage" value="0">
        
        <!-- Media -->
        <?php if (isset($content->media) && !empty($content->media)): ?>
            <div class="col-md-6 mb-4 text-left" id="mediaContainer">
                <label for="media"><strong><span class="alert2 text-danger d-none hide"><i class="fas fa-exclamation-triangle"></i> </span><?php echo TFISH_MEDIA; ?></strong></label>
                <input id="media" name="media" type="file" data-preview-file-type="text" value="<?php echo $content->escape('media'); ?>">
            </div>
            <?php else: ?>
                <div class="col-md-6 mb-4 text-left" id="mediaContainer">
                    <label for="media"><span class="alert2 text-danger d-none  hide"><i class="fas fa-exclamation-triangle"></i> </span><strong><?php echo TFISH_MEDIA; ?></strong></label>
                    <input id="media" name="media" type="file" data-preview-file-type="text">
                </div>
            <?php endif; ?>
            <script>
            $(document).ready(function() {
                
                $("#media").fileinput({
                    'showUpload': false,
                    'previewFileType': ["any"],
                    'initialPreview': '<?php if ($content->media) echo TFISH_MEDIA_URL . $content->escape("media"); ?>',
                    'initialPreviewAsData': true,
                    'initialPreviewShowDelete': false,
                    'initialPreviewDownloadUrl': '<?php if ($content->media) echo TFISH_MEDIA_URL . $content->escape("media"); ?>',
                    'initialCaption': '<?php echo $content->escape("media"); ?>',
                    'allowedFileExtensions': ["doc","docx","gif","gz","jpg","mp3","mp4","odt",
                        "ods","odp","oga","ogg","ogv","pdf","png","ppt", "pptx", "tar","wav","webm",
                        "xls","xlsx","zip"],
                    'theme': "fa"
                });
                
                function checkMedia() {
                    var allowedExtensionTypes = [""];
                    var mediaMimeType = $('#format').val() ? $('#format').val() : '';

                    switch($("#type").val()) {
                        case '': // No media file.
                            break;
                        
                        case 'TfishAudio':
                            allowedExtensionTypes.push(
                                "audio/ogg",
                                "audio/ogg",
                                "audio/mpeg",
                                "audio/x-wav"
                            );
                            break;
                            
                        case 'TfishImage':
                            allowedExtensionTypes.push(
                                "image/gif",
                                "image/jpeg",
                                "image/png"
                            );
                            break;
                            
                        case 'TfishVideo':
                            allowedExtensionTypes.push(
                                "video/mp4",
                                "video/ogg",
                                "video/webm"
                            );
                            break;
                            
                        default:
                            allowedExtensionTypes.push(
                                "application/msword", // Documents.
                                "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                                "application/pdf",
                                "application/vnd.ms-powerpoint",
                                "application/vnd.openxmlformats-officedocument.presentationml.presentation",
                                "application/vnd.oasis.opendocument.text",
                                "application/vnd.oasis.opendocument.spreadsheet",
                                "application/vnd.oasis.opendocument.presentation",
                                "application/vnd.ms-excel",
                                "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
                                "image/gif", // Images.
                                "image/jpeg",
                                "image/png",
                                "audio/mpeg", // Audio.
                                "audio/ogg",
                                "audio/ogg",
                                "audio/x-wav",
                                "video/mp4", // Video.
                                "video/ogg",
                                "video/webm",
                                "application/zip", // Archives.
                                "application/x-gzip",
                                "application/x-tar"
                            );
                            break;
                    }
                    
                    // Show or hide the mimetype warning.
                    if ($.inArray(mediaMimeType, allowedExtensionTypes) === -1) {
                        // Mimetype is bad, show the alerts.
                        $('.alert').removeClass('d-none');
                        $('.alert').removeClass('hide');
                        $('.alert').addClass('d-block');
                        $('.alert').addClass('show');
                        $('.alert2').removeClass('d-none');
                        $('.alert2').removeClass('hide');
                        $('.alert2').addClass('d-inline');
                        $('.alert2').addClass('show');   
                    } else {
                        // Mimetype is good, or there is no media file, hide the alerts.
                        $('.alert').removeClass('d-block');
                        $('.alert').removeClass('show');
                        $('.alert').addClass('d-none');
                        $('.alert').addClass('hide');
                        $('.alert2').removeClass('d-inline');
                        $('.alert2').removeClass('show');
                        $('.alert2').addClass('d-none');
                        $('.alert2').addClass('hide');
                    }
                }
                
                function getFileExtension(filename) {
                    return filename.slice((filename.lastIndexOf(".") - 1 >>> 0) + 2);
                }
                
                function getMimeType(extension) {
                    var mimeTypes = {};
                    
                    // Documents.
                    mimeTypes.doc = "application/msword";
                    mimeTypes.docx = "application/vnd.openxmlformats-officedocument.wordprocessingml.document";
                    mimeTypes.pdf = "application/pdf";
                    mimeTypes.ppt = "application/vnd.ms-powerpoint";
                    mimeTypes.pptx = "application/vnd.openxmlformats-officedocument.presentationml.presentation";
                    mimeTypes.odt = "application/vnd.oasis.opendocument.text";
                    mimeTypes.ods = "application/vnd.oasis.opendocument.spreadsheet";
                    mimeTypes.odp = "application/vnd.oasis.opendocument.presentation";
                    mimeTypes.xls = "application/vnd.ms-excel";
                    mimeTypes.xlsx = "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";
                    
                    // Images.
                    mimeTypes.gif = "image/gif";
                    mimeTypes.jpg = "image/jpeg";
                    mimeTypes.png = "image/png";
                    
                    // Audio.
                    mimeTypes.mp3 = "audio/mpeg";
                    mimeTypes.oga = "audio/ogg";
                    mimeTypes.ogg = "audio/ogg";
                    mimeTypes.wav = "audio/x-wav";
                    
                    // Video.
                    mimeTypes.mp4 = "video/mp4";
                    mimeTypes.ogv = "video/ogg";
                    mimeTypes.webm = "video/webm";
                    
                    // Archives.
                    mimeTypes.zip = "application/zip";
                    mimeTypes.gz = "application/x-gzip";
                    mimeTypes.tar = "application/x-tar";

                    return mimeTypes[extension];
                }

                // Set flag that media file should be deleted from server.
                $('#media').on('fileclear', function(tf_deleteMedia) {
                    document.getElementById("format").value="";
                    document.getElementById("deleteMedia").value = "1";
                    checkMedia();
                });
                
                $('#media').on('change', function(event) {
                    var filename = document.getElementById("media").files[0].name;
                    var extension = getFileExtension(filename);
                    var mimetype = getMimeType(extension);
                    var format = document.getElementById("format");                    
                    document.getElementById("format").value = mimetype;
                    checkMedia();
                });
                
                // Validate media file mimetype on changing the content type.
                $('#type').change(function(tf_resetMedia) {
                    checkMedia();
                });
            });
            </script>
            
            <!-- Delete media -->
            <input type="hidden" name="deleteMedia" id="deleteMedia" value="0">
        
        <!-- Caption -->
        <div class="col-md-6 mb-3 text-left" id="captionContainer">
            <label for="caption"><strong><?php echo TFISH_CAPTION; ?></strong></label>
            <input type="text" class="form-control" name="caption" id="caption" <?php if (isset($content->caption)) echo 'value="' . $content->escape('caption') . '"'; ?>>
        </div>

        <!-- Rights -->
        <div class="col-md-6 mb-3 text-left" id="rightsContainer">
            <label for="rights"><strong><?php echo TFISH_RIGHTS; ?></strong></label>
            <select class="form-control custom-select" name="rights" id="rights" required>
                <?php
                    foreach ($rights as $key => $right) {
                        if ($content->rights === $key) {
                            echo '<option value="' . $key . '" selected>' . $right . '</option>';
                        } else {
                            echo '<option value="' . $key . '">' . $right . '</option>';
                        }
                    }
                ?>
            </select>
        </div>

        <!-- Language -->
        <div class="col-md-6 mb-3 text-left" id="languageContainer">
            <label for="language"><strong><?php echo TFISH_LANGUAGE; ?></strong></label>
                <select class="form-control custom-select" name="language" id="language" required>
                    <?php
                        foreach ($languages as $key => $value) {
                            if (isset($content->language) && $content->language === $key) {
                                echo '<option value="' . $key . '" selected>' . $value . '</option>';
                            } else {
                                echo '<option value="' . $key . '">' . $value . '</option>';
                            }
                        }
                    ?>
                </select>
        </div>

        <!-- Online status -->
        <div class="col-md-6 mb-3 text-left" id="onlineContainer">
            <p><strong><?php echo TFISH_ONLINE_STATUS; ?></strong></p>
            <div class="custom-control custom-radio custom-control-inline">
                <input type="radio" id="online" name="online" value="1" class="custom-control-input" <?php if ($content->online) { echo 'checked="checked"'; } ?> required>
                <label class="custom-control-label" for="online"><?php echo TFISH_ONLINE; ?></label>
            </div>
            <div class="custom-control custom-radio custom-control-inline">
                <input type="radio" id="offline" name="online" value="0" class="custom-control-input" <?php if (!$content->online) { echo 'checked="checked"'; } ?> required>
                <label class="custom-control-label" for="offline"><?php echo TFISH_OFFLINE; ?></label>
            </div>
        </div>
        
        <!-- Counter -->
        <?php if ($content->counter): ?>
        <input type="hidden" id="counter" name="counter" value="<?php echo $content->counter; ?>" />
        <?php endif; ?>

        <!-- Format -->
        <?php if ($content->format): ?>
        <input type="hidden" id="format" name="format" value="<?php echo $content->format; ?>" />
        <?php else: ?>
        <input type="hidden" id="format" name="format" value="" />
        <?php endif; ?>

        <!-- File size -->
        <?php if ($content->file_size): ?>
        <input type="hidden" id="file_size" name="file_size" value="<?php echo $content->file_size; ?>" />
        <?php endif; ?>
        
        <div class="col-md-12" id="metaHeader">
            <h2><?php echo TFISH_META_TAGS; ?><h2>
            <hr>
        </div>

        <!-- Meta title -->
        <div class="col-md-6 mb-3 text-left" id="metaTitleContainer">
            <label for="meta_title"><strong><?php echo TFISH_META_TITLE; ?></strong></label>
            <input type="text" class="form-control" name="meta_title" id="meta_title" <?php if (isset($content->meta_title)) { echo 'value="' . $content->escape('meta_title') . '"'; } ?>>
        </div>

        <!-- SEO -->
        <div class="col-md-6 mb-3 text-left" id="seoContainer">
            <label for="seo"><strong><?php echo TFISH_SEO; ?></strong></label>
            <input type="text" class="form-control" name="seo" id="seo" <?php if (isset($content->seo)) { echo 'value="' . $content->escape('seo') . '"'; } ?>>
        </div>

        <!-- Meta description -->
        <div class="col-12 mb-3 text-left" id="metaDescriptionContainer">
            <label for="meta_description"><strong><?php echo TFISH_META_DESCRIPTION; ?></strong></label>
            <input type="text" class="form-control" name="meta_description" id="meta_description" <?php if (isset($content->meta_description)) { echo 'value="' . $content->escape('meta_description') . '"'; } ?>>
        </div>
    
    </div> <!-- /row -->

    <!-- Action buttons -->
    <div class="float-left clearfix">
        <button class="btn btn-primary" onclick="this.form.elements.op.value = '<?php echo $op; ?>';
                submit()"><?php echo $action; ?></button>
        <button class="btn btn-primary" onclick="this.form.elements.op.value = '';
                submit()" formnovalidate><?php echo TFISH_CANCEL; ?></button>
    </div>
    
    <!-- Note that the default $op value MUST be passed in by the controller. It can be modified onChange of the type select box -->
    <input type="hidden" name="op" id="op" value="<?php echo $op; ?>" />

    <!-- Show or hide fields that are / not used by specific content subclasses -->
    <script>
        var allowedProperties = ['teaserContainer', 'descriptionContainer', 'captionContainer',
            'creatorContainer', 'dateContainer', 'imageContainer', 'languageContainer',
            'mediaContainer', 'parentContainer', 'publisherContainer', 'rightsContainer',
            'tagsContainer', 'metaHeader', 'metaTitleContainer', 'seoContainer',
            'metaDescriptionContainer'];
        $(document).ready(function () {
            $("#type").bind('change', function () {
                $.each(allowedProperties, function (i, value) {
                    $('#' + value).show();
                });
                if ($("#type").val() === 'TfishTag') {
                    var disabledProperties = [
                        'creatorContainer', 'dateContainer', 'languageContainer',
                        'rightsContainer', 'publisherContainer', 'tagsContainer'];
                    $.each(disabledProperties, function (i, value) {
                        $('#' + value).hide();
                    });
                }
                if ($("#type").val() === 'TfishBlock') {
                    var disabledProperties = [
                        'teaserContainer', 'mediaContainer', 'creatorContainer', 'imageContainer',
                        'captionContainer', 'dateContainer', 'parentContainer', 'languageContainer',
                        'rightsContainer', 'publisherContainer', 'metaHeader', 'metaTitleContainer',
                        'seoContainer', 'metaDescriptionContainer'];
                    $.each(disabledProperties, function (i, value) {
                        $('#' + value).hide();
                    });
                }
            });
            $('#type').trigger('change');
        });
    </script>

    </form>
