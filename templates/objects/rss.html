<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title><?php echo TfishFilter::escape($rss->title); ?></title>
    <link><?php echo TfishFilter::escape($rss->link); ?></link>
    <description><?php echo TfishFilter::escape($rss->description); ?></description>
    <generator><?php echo TfishFilter::escape($rss->generator); ?></generator>
    <managingEditor><?php echo TfishFilter::escape($rss->managingEditor); ?></managingEditor>
    <webMaster><?php echo TfishFilter::escape($rss->webMaster); ?></webMaster>
    <atom:link href="<?php echo TfishFilter::escape(TFISH_RSS_URL) . $tag_id; ?>" rel="self" type="application/rss+xml" />
<?php if (isset($items) && !empty($items)): ?>
<?php foreach ($items as $item): ?>
    <item>
<?php if ($item->title): ?>
      <title><?php echo $item->escape('title'); ?></title>
<?php endif; ?>
      <link><?php echo $item->getURL(true); ?></link>
<?php if ($item->teaser): ?>
      <description><![CDATA[<?php echo $item->teaser; ?>]]></description>
<?php endif; ?>
<?php if (($item->media) && is_readable(TFISH_MEDIA_PATH . $item->media)):
$length = filesize(TFISH_MEDIA_PATH . $item->media);
$mimetype = $mimetype_list[pathinfo($item->media, PATHINFO_EXTENSION)]; ?>
<enclosure url="<?php echo TFISH_ENCLOSURE_URL . $item->id; ?>" length="<?php echo $length; ?>" type="<?php echo $mimetype; ?>" />
<?php unset($length, $mimetype); endif; ?>
<?php if ($item->submission_time): ?>
      <pubDate><?php echo gmdate(DATE_RSS, ($item->submission_time)); ?></pubDate>
<?php endif; ?>
      <guid isPermaLink="true"><?php echo TFISH_PERMALINK_URL . $item->id; ?></guid>
    </item>
<?php endforeach; ?>
<?php endif; ?>
  </channel>
</rss>